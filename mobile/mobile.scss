// =============================================================================
// Mobile Landing Page Styling - The Pinnacle of Polish & Precision
//
// This stylesheet re-engineers Discourse topic pages into a highly refined,
// visually engaging, and perfectly clean landing page experience. Every detail,
// from typography to shadows and button interactions, is meticulously crafted
// for optimal mobile presentation and user engagement.
//
// Designed for seamless integration within Discourse theme components,
// it elevates the user interface with a modern, minimalist aesthetic.
// =============================================================================

// --- Core Imports & Design Tokens ---
// Import foundational Discourse theme variables (colors, fonts, etc.)
// These variables define the base visual language of your Discourse forum.
@import "common/foundation/variables";

// Custom Sass Design Tokens for Unmatched Consistency & Control
// These variables provide compile-time values for Sass functions and act as
// robust fallbacks for CSS variables, ensuring smooth compilation and
// a consistent design system.

// Color Overrides & Fallbacks for Sass Functions
// Ensure these match your Discourse theme's custom CSS properties for
// --primary-action, --secondary-action, etc., or define sensible defaults.
$color-primary-action: #3498db;          // A vibrant, inviting blue for primary calls-to-action
$color-primary-action-contrast: #ffffff; // White text for maximum contrast on primary buttons
$color-secondary-action: #2ecc71;        // A complementary, encouraging green for secondary actions
$color-secondary-action-contrast: #ffffff; // White text for contrast on secondary buttons
$color-tertiary-action: #e74c3c;         // A distinct, strong red for specific, high-attention actions
$color-tertiary-action-contrast: #ffffff; // White text for contrast on tertiary buttons

// Derived Colors for Subtle Accents and Borders
$color-primary-action-light: lighten($color-primary-action, 20%); // For lighter accents/borders
$color-primary-action-dark: darken($color-primary-action, 8%);    // For button hover states
$color-secondary-action-dark: darken($color-secondary-action, 8%); // For button hover states
$color-tertiary-action-dark: darken($color-tertiary-action, 8%);   // For button hover states

// Spacing System (Modular Scale for Consistent Layouts)
$spacing-xxs: 4px;
$spacing-xs: 8px;
$spacing-sm: 12px;
$spacing-md: 16px;
$spacing-lg: 24px;
$spacing-xl: 32px;
$spacing-xxl: 48px;
$spacing-3xl: 64px;
$spacing-4xl: 80px;

// Border Radius System (for consistent rounded corners)
$border-radius-sm: 4px;
$border-radius-md: 8px;
$border-radius-lg: 12px;
$border-radius-pill: 9999px; // For fully rounded elements

// Shadow System (for subtle depth and separation)
// These shadows are designed to be soft, modern, and non-distracting.
$shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.05);
$shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.08);
$shadow-md: 0 5px 15px rgba(0, 0, 0, 0.1);
$shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.15);
$shadow-interactive: 0 8px 20px rgba(0, 0, 0, 0.2); // For hover/active states

// Transition System (for smooth interactive elements)
$transition-base: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); // Standard smooth transition
$transition-fast: all 0.2s ease-out; // Quicker transitions for subtle effects


// --- Utility Function: str-split ---
// Essential for dynamic category/tag class generation.
// This function remains optimized for robust string manipulation.
/// Splits a String into a list of substrings using `$separator`.
/// @param {string} $string - The string to split.
/// @param {string} $separator [null] - The string to split by.
/// @param {number} $limit [null] - Optional limit on the number of splits to be found.
/// @return {list} A list of substrings.
@function str-split($string, $separator: null, $limit: null) {
  $string: unquote($string);
  @if type-of($string) != "string" {
    @error "`str-split` function expects a string for `$string`, but received a #{type-of($string)}.";
  }
  $result: ();
  @if not $separator {
    @return ($string);
  }
  @if $separator == "" {
    @for $i from 1 through str-length($string) {
      $result: append($result, str-slice($string, $i, $i));
    }
    @return $result;
  }
  $current-string: $string;
  $separator-length: str-length($separator);
  @while str-index($current-string, $separator) {
    @if $limit and length($result) >= ($limit - 1) {
      $result: append($result, $current-string);
      $current-string: "";
    } @else {
      $index: str-index($current-string, $separator);
      $result: append($result, str-slice($current-string, 1, ($index - 1)));
      $current-string: str-slice($current-string, ($index + $separator-length));
    }
  }
  @if $current-string != "" {
    $result: append($result, $current-string);
  }
  @if $limit and $limit > 0 and length($result) > $limit {
    $limited-result: ();
    @for $i from 1 through $limit {
      $limited-result: append($limited-result, nth($result, $i));
    }
    @return $limited-result;
  }
  @return $result;
}


// =============================================================================
// Mobile Specific Styling Block - The Core Transformation
//
// This block ensures all the landing page specific styles are applied only
// when `$mobile_enabled` is true, keeping your desktop experience untouched.
// =============================================================================
@if $mobile_enabled == "true" {
  // --- Dynamic Category & Tag Extension ---
  // Connects theme settings to the core landing page styling.
  $blog-categories: str-split($blog_category, ",");
  @each $category in $blog-categories {
    .category-#{$category} {
      @extend %blog-category;
    }
  }

  $blog-tags: str-split($blog_tag, "|");
  @each $tag in $blog-tags {
    .tag-#{$tag} {
      @extend %blog-tag;
    }
  }

  // --- Base Landing Page Structure & Sectioning ---
  // Defines the visual foundation for content blocks, giving them a distinct, card-like appearance.
  %blog-tag,
  %blog-category {
    // Shared styling for all major content sections.
    #topic-title,
    .blog-image-container,
    #post_1 {
      background-color: var(--primary-background-alt); // A subtle, complementary background
      padding: $spacing-md;                            // Consistent internal padding
      margin-bottom: $spacing-lg;                      // Generous space between sections
      border-radius: $border-radius-md;                // Softly rounded corners for a modern feel
      box-shadow: $shadow-sm;                          // A delicate, ambient shadow
      overflow: hidden;                                // Ensures content adheres to border-radius
      transition: $transition-fast;                    // Smooth transition for any potential state changes
    }

    // --- Hero Section: The Grand Entrance ---
    // This section acts as the primary visual and textual hook for the landing page.
    #topic-title {
      text-align: center;
      padding-top: $spacing-3xl; // Substantial top padding for impactful presence
      padding-bottom: $spacing-xl;

      h1 {
        font-size: 2.6em;         // Dominant heading size for immediate attention
        line-height: 1.1;         // Tighter line-height for visual punch
        margin-bottom: $spacing-sm; // Close tie to the subheading
        color: var(--primary-high); // High contrast, impactful color
        font-weight: 800;         // Extra-bold for maximum emphasis
        letter-spacing: -0.04em;  // Fine-tuned kerning for large display text
        text-rendering: optimizeLegibility; // Ensures crisp text rendering
      }
      p { // The compelling subheading or tagline.
        color: var(--primary-medium); // Slightly subdued for hierarchical balance
        font-size: 1.25em;          // Larger for readability and impact
        line-height: 1.5;           // Balanced line height for comfortable reading
        max-width: 90%;             // Constrains width for better readability on wider mobiles
        margin: 0 auto $spacing-lg auto; // Centered with good bottom spacing
        font-weight: 400;           // Standard weight for clear information delivery
      }
      a.edit-topic .d-icon { // Editor icon is hidden for a clean, public landing page view.
        display: none;
      }
    }

    // --- Hero Image Container: The Visual Anchor ---
    // Provides a strong, engaging visual focal point for the landing page.
    .blog-image-container {
      // The background image styling is handled by Discourse's theme settings.
      .blog-image {
        height: 350px;            // Ample height for a commanding visual
        background-size: cover;   // Ensures the image fills the space, cropping as necessary
        border-radius: $border-radius-md; // Consistent rounded corners
        box-shadow: $shadow-md;   // A more pronounced, elegant shadow for the main visual
      }
    }

    // --- Main Content Section (Post 1): The Narrative Core ---
    // Transforms the Discourse post into the main body of the landing page,
    // where detailed information and calls-to-action reside.
    #post_1 {
      padding: $spacing-xl $spacing-lg; // Generous internal padding for spacious content flow

      .topic-body {
        padding-top: 0;

        &.highlighted {
          animation: none; // Disables any highlight animations for a static, clean presentation.
        }

        // Essential Discourse elements that are hidden for a focused landing page experience.
        .topic-avatar,
        .topic-meta-data {
          display: none;
        }

        .contents {
          border-top: none;      // Removes any default top border for seamless content flow.
          padding-top: 0;        // Ensures content starts immediately.
        }

        .cooked {
          font-size: 1.15em;      // Base font size optimized for mobile readability.
          line-height: 1.7;       // Optimal line height for long-form content comfort.
          word-wrap: break-word;  // Ensures long words wrap gracefully.
          overflow-wrap: break-word; // Modern alternative to word-wrap.
          color: var(--primary-text); // High contrast text color.

          // --- Interactive Buttons within Content ---
          // Styles for links within the content that function as calls-to-action.
          // Exclusions prevent styling of internal Discourse links or emoji.
          a:not(.lightbox):not(.d-icon):not(.mention):not(.hashtag):not(.cooked__link-text) {
            display: inline-block;
            background-color: var(--primary-action, #{$color-primary-action});
            color: var(--primary-action-contrast, #{$color-primary-action-contrast});
            padding: 15px $spacing-3xl;               // Spacious padding for easy tapping.
            text-decoration: none;                    // Removes underlines for a clean button look.
            border-radius: $border-radius-lg;         // Smooth, inviting rounded corners.
            font-weight: 700;                         // Bold text for prominence.
            margin: $spacing-md $spacing-sm $spacing-md 0; // Balanced spacing around buttons.
            transition: $transition-base;             // Smooth transitions for hover effects.
            white-space: nowrap;                      // Prevents button text from wrapping.
            box-shadow: $shadow-sm;                   // Subtle initial shadow for depth.
            font-size: 1.05em;                        // Slightly larger text for buttons.

            &:hover {
              background-color: $color-primary-action-dark; // Darken effect using Sass variable.
              transform: translateY(-3px) scale(1.01);      // Gentle lift and slight scale.
              box-shadow: $shadow-interactive;              // Enhanced shadow on hover.
            }

            // Secondary Button Style (apply via class="button-secondary" in HTML)
            &.button-secondary {
              background-color: var(--tertiary-action, #{$color-tertiary-action});
              color: var(--tertiary-action-contrast, #{$color-tertiary-action-contrast});
              &:hover {
                background-color: $color-tertiary-action-dark;
              }
            }

            // Outline Button Style (apply via class="button-outline" in HTML)
            &.button-outline {
                background-color: transparent;
                color: var(--primary-action, #{$color-primary-action});
                border: 2px solid var(--primary-action, #{$color-primary-action});
                box-shadow: none; // No initial shadow for outline style.
                &:hover {
                    background-color: var(--primary-action-low, $color-primary-action-light);
                    color: var(--primary-action-contrast, #{$color-primary-action-contrast});
                    box-shadow: $shadow-sm; // Add subtle shadow on hover.
                }
            }
          }

          // --- Typography Refinements for Content Readability ---
          // Drop Cap Styling for the very first letter of the content.
          big {
            font-size: 3rem;            // Magnified for a distinct visual start.
            line-height: 1;             // Tightly aligns with the text flow.
            letter-spacing: -0.02em;    // Fine-tuned kerning.
            display: inline-block;
            font-family: 'Playfair Display', Georgia, serif; // Elegant serif font.
            margin-right: $spacing-xs;  // Small space for visual separation.
            color: var(--primary-action, #{$color-primary-action}); // Accent color for emphasis.
            font-weight: bold;
          }

          // Headings within the cooked content, creating clear sub-sections.
          h2, h3, h4, h5, h6 {
            font-family: var(--font-family-headings, 'Montserrat', 'Arial', sans-serif); // Modern, clean sans-serif.
            color: var(--primary-high); // High contrast.
            margin-top: $spacing-xl;    // Significant space above new content sections.
            margin-bottom: $spacing-md; // Consistent space below heading.
            line-height: 1.3;           // Optimized for readability.
            font-weight: 700;           // Bold for clear hierarchy.
          }
          h2 { font-size: 1.7em; letter-spacing: -0.015em; } // Sub-section title.
          h3 { font-size: 1.4em; } // Content grouping title.
          h4 { font-size: 1.15em; } // Minor heading.

          p {
            margin-bottom: $spacing-lg; // Generous paragraph spacing for breathability.
            line-height: 1.75;          // Superb line height for comfortable long-form reading.
          }

          ul, ol {
            padding-left: $spacing-lg; // Indent lists for clear structure.
            margin-bottom: $spacing-xl; // More space below lists.
            li {
              margin-bottom: $spacing-xs; // Subtle spacing between list items.
              line-height: 1.6;           // Comfortable line height for list items.
            }
          }

          // Blockquote Styling: Elegant presentation for testimonials or key quotes.
          blockquote {
            background: var(--primary-very-low);        // Soft, muted background.
            color: var(--primary-text);                  // Standard text color.
            border-left: 6px solid var(--primary-action-low-mid, #{$color-primary-action-light}); // Prominent accent border.
            padding: $spacing-md $spacing-lg;            // Ample internal padding.
            margin: $spacing-xl 0;                       // Significant vertical margin for separation.
            border-radius: $border-radius-sm;            // Subtle rounding.
            font-style: italic;                          // Italicized text for a classic quote feel.
            position: relative;                          // For precise quote icon positioning.
            box-shadow: $shadow-sm;                      // Gentle ambient shadow.
            overflow: hidden;                            // Ensures content stays within bounds.

            &:before { // Large, elegant quote icon as a background element.
              color: var(--primary-low-mid, lighten($color-primary-action, 30%));
              content: '“';
              font-size: 6em; // Even larger quote mark.
              line-height: 0.1em;
              position: absolute;
              top: $spacing-sm;
              left: $spacing-sm;
              opacity: 0.15; // Very subtle, ghostly presence.
              font-family: serif; // Ensures classic serif for the quote mark.
              z-index: 0; // Behind text for a layered effect.
            }
            p {
              display: inline; // Ensures paragraphs flow as one block inside quote.
              position: relative; // Places text above the pseudo-element.
              z-index: 1;
            }
          }

          // --- Image Presentation within Content ---
          // Hides redundant initial images, preventing duplication of hero image.
          & > p:first-child + div.lightbox-wrapper,
          & > p img:not(.emoji):first-child {
            display: none;
          }

          // Styles for images embedded throughout the content.
          & > p ~ p img:not(.emoji) {
            display: block;
            max-width: 100%;
            height: auto;
            margin: $spacing-xl auto;   // Centered with ample vertical spacing.
            border-radius: $border-radius-md; // Rounded corners for images.
            box-shadow: $shadow-md;     // Clean, prominent shadow for visual pop.
          }

          figure { // Enhanced styling for images with captions (figure/figcaption).
            margin: $spacing-xl 0;
            padding: 0;
            text-align: center;
            img {
              max-width: 100%;
              height: auto;
              border-radius: $border-radius-md;
              box-shadow: $shadow-md; // Consistent shadow.
            }
          }

          figcaption {
            margin-top: $spacing-sm;           // Clear separation between image and caption.
            font-size: 0.95em;                  // Slightly larger for readability.
            font-weight: normal;                // Standard weight.
            text-align: center;
            color: var(--primary-medium);       // Subdued color for less prominence.
            line-height: 1.4;
          }
        }
      }

      // Hide all default Discourse post controls (likes, share, reply, topic map, etc.)
      // for a streamlined, single-purpose landing page.
      nav.post-controls,
      .topic-map,
      .post-admin-menu {
        display: none;
      }
    }

    // --- Dedicated Call-to-Action Section: The Conversion Catalyst ---
    // This section is designed for maximum visual impact and user conversion.
    // (Requires a `div class="call-to-action"` element in your HTML template).
    .call-to-action {
      background-color: var(--secondary-background); // A contrasting, often vibrant background.
      padding: $spacing-4xl $spacing-lg;              // Extremely generous padding for prominence.
      text-align: center;
      border-radius: $border-radius-lg;               // More pronounced rounded corners.
      margin-top: $spacing-xxl;                       // Significant space above.
      margin-bottom: $spacing-xxl;                    // Significant space below.
      box-shadow: $shadow-lg;                         // Strong, encompassing shadow for a floating effect.
      transition: $transition-base;                   // Smooth transition for any interactions.

      &:hover {
        box-shadow: $shadow-interactive; // Even stronger shadow on hover for engagement.
      }

      h2 {
        font-size: 2em;                               // Large, commanding heading.
        color: var(--secondary-strong);               // High contrast, impactful color for CTA heading.
        margin-bottom: $spacing-md;                   // Spacing below heading.
        font-weight: 800;                             // Extra bold for authority.
        line-height: 1.2;
      }

      p {
        color: var(--secondary-text);                 // Clear, readable text for CTA description.
        margin-bottom: $spacing-lg;                   // Space before the button.
        font-size: 1.15em;
        line-height: 1.6;
        max-width: 90%;                               // Constrain width for readability.
        margin-left: auto;
        margin-right: auto;
      }

      a.button { // The hero button for the Call-to-Action section.
        display: inline-block;
        background-color: var(--secondary-action, #{$color-secondary-action});
        color: var(--secondary-action-contrast, #{$color-secondary-action-contrast});
        padding: 18px $spacing-4xl;                   // Extra large padding for maximum tap target.
        text-decoration: none;
        border-radius: $border-radius-lg;             // Prominently rounded corners.
        font-weight: bold;                            // Bold text.
        font-size: 1.25em;                            // Larger font for commanding presence.
        transition: $transition-base;                 // Smooth, inviting transition.
        box-shadow: $shadow-md;                       // Initial shadow for depth.

        &:hover {
          background-color: $color-secondary-action-dark; // Darken on hover using Sass variable.
          transform: translateY(-5px) scale(1.02);    // More dramatic lift and slight scale.
          box-shadow: $shadow-interactive;            // Deep, engaging shadow on hover.
        }
      }
    }

    // --- Minimalist Landing Page Footer ---
    // A clean, unobtrusive footer providing essential information.
    // (Requires a `div class="landing-page-footer"` element in your HTML template).
    .landing-page-footer {
      text-align: center;
      padding: $spacing-lg $spacing-md;
      color: var(--primary-low-mid); // Muted color for less prominence.
      font-size: 0.85em;
      border-top: 1px solid var(--primary-low); // Subtle visual separator.
      background-color: var(--primary-background); // Matches overall background.
      margin-top: $spacing-xxl; // Ample space from content above.
    }
  }
}
