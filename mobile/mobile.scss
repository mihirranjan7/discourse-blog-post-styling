// =============================================================================
// Mobile Landing Page Styling - The Ultimate Refinement
//
// This stylesheet transforms Discourse topic pages into a polished,
// minimalist, and highly effective landing page experience specifically
// optimized for mobile devices. It prioritizes readability, clear calls-to-action,
// and modern aesthetics through meticulous control over typography, spacing,
// and visual elements.
//
// Designed for integration within Discourse theme components.
// =============================================================================

// --- Core Imports & Variables ---
// Import foundational Discourse theme variables (colors, fonts, etc.)
@import "common/foundation/variables";

// Define Sass Fallback Variables for Colors & Design Elements
// These values are used by Sass color functions (like darken, lighten) during
// compilation. At runtime, the CSS variables (e.g., var(--primary-action))
// will take precedence if they are defined in your Discourse theme settings.
// This allows for dynamic theme customization while ensuring Sass compilation.

// Primary Brand Colors - Strong, clear, and action-oriented
$primary-action-sass: #007bff; // A professional, accessible blue
$primary-action-contrast-sass: #ffffff; // White text for maximum contrast on primary action

// Secondary Brand Colors - Complementary, for secondary actions or accents
$secondary-action-sass: #28a745; // A vibrant green for success/positive actions
$secondary-action-contrast-sass: #ffffff; // White text for maximum contrast on secondary action

// Tertiary Action Color - For less frequent or distinct actions (e.g., outline buttons)
$tertiary-action-sass: #6c757d; // A neutral grey for subtle actions
$tertiary-action-contrast-sass: #ffffff; // White text for contrast

// Calculated Colors - For gradients, borders, subtle backgrounds
$primary-action-low-mid-sass: lighten($primary-action-sass, 25%); // Lighter primary for accents/borders
$primary-action-low-sass: lighten($primary-action-sass, 45%); // Very light primary for subtle hover states

// Spacing & Global Design Tokens for Consistency and Responsiveness
$spacing-xxs: 4px;
$spacing-xs: 8px;
$spacing-sm: 12px; // Adjusted for slightly more breathing room
$spacing-md: 20px;
$spacing-lg: 32px; // Increased for clearer separation
$spacing-xl: 48px; // Significant spacing for major sections
$spacing-xxl: 72px; // Ample space for hero and CTA sections

// Border Radii - Soft and modern
$border-radius-sm: 4px;
$border-radius-md: 8px;
$border-radius-lg: 12px;

// Shadows - For depth and emphasis
$shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.1); // Slightly more prominent
$shadow-md: 0 5px 15px rgba(0, 0, 0, 0.15); // Enhanced for hero images/main elements
$shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2); // Stronger for prominent CTA

// --- Utility Function: str-split ---
// Splits a string into a list of substrings based on a given separator.
// This function allows for dynamic generation of category/tag-specific classes.
//
// Source: Modified from pascalduez (https://gist.github.com/pascalduez/065e560c6314c7e9d7f8)
// Original License: MIT
// ---
@function str-split($string, $separator: null, $limit: null) {
  $string: unquote($string);

  @if type-of($string) != "string" {
    @error "`str-split` function expects a string for `$string`, but received a #{type-of($string)}.";
  }

  $result: ();

  @if not $separator {
    @return ($string);
  }

  @if $separator == "" {
    @for $i from 1 through str-length($string) {
      $result: append($result, str-slice($string, $i, $i));
    }
    @return $result;
  }

  $current-string: $string;
  $separator-length: str-length($separator);

  @while str-index($current-string, $separator) {
    @if $limit and length($result) >= ($limit - 1) {
      $result: append($result, $current-string);
      $current-string: ""; // Terminate loop
    } @else {
      $index: str-index($current-string, $separator);
      $result: append($result, str-slice($current-string, 1, ($index - 1)));
      $current-string: str-slice($current-string, ($index + $separator-length));
    }
  }

  @if $current-string != "" {
    $result: append($result, $current-string);
  }

  @if $limit and $limit > 0 and length($result) > $limit {
    $limited-result: ();
    @for $i from 1 through $limit {
      $limited-result: append($limited-result, nth($result, $i));
    }
    @return $limited-result;
  }

  @return $result;
}

// =============================================================================
// Mobile Specific Styling Block
//
// This block contains all styles applied when `$mobile_enabled` is true,
// ensuring these optimizations are compiled only for mobile environments.
// =============================================================================
@if $mobile_enabled == "true" {
  // --- Dynamic Class Generation ---
  // Extends base styling for specific categories and tags, allowing for
  // targeted design adjustments if needed (though %blog-category handles most).
  $blog-categories: str-split($blog_category, ",");
  @each $category in $blog-categories {
    .category-#{$category} {
      @extend %blog-category;
    }
  }

  $blog-tags: str-split($blog_tag, "|");
  @each $tag in $blog-tags {
    .tag-#{$tag} {
      @extend %blog-tag;
    }
  }

  // --- Base Landing Page Structure (Placeholder Styles) ---
  // These styles form the foundation for a cohesive landing page look,
  // applied consistently across category/tag contexts.
  %blog-tag,
  %blog-category {
    // General card/section styling for key content blocks
    #topic-title,
    .blog-image-container,
    #post_1 {
      background-color: var(--primary-background-alt); // Use a distinct background for sections
      padding: $spacing-md; // Consistent internal padding
      margin-bottom: $spacing-lg; // Ample space between sections
      border-radius: $border-radius-md; // Soft rounded corners
      box-shadow: $shadow-sm; // Subtle shadow for depth
      overflow: hidden; // Ensure content respects border-radius
    }

    // --- Hero Section: Topic Title ---
    // Acts as the primary heading area, drawing immediate attention.
    #topic-title {
      text-align: center;
      padding-top: $spacing-xl; // More top padding for a strong hero feel
      padding-bottom: $spacing-md;

      h1 {
        font-size: 2.8em; // Larger, more impactful heading
        line-height: 1.1; // Tighter line height for better visual impact
        margin-bottom: $spacing-sm; // Space below the main heading
        color: var(--primary-high); // Prominent text color
        font-weight: 800; // Extra bold for strong presence
        letter-spacing: -0.03em; // Slight kerning adjustment for large text
      }
      p {
        // Designed for a compelling subtitle or brief intro
        color: var(--primary-medium); // Slightly muted for secondary importance
        font-size: 1.25em; // Larger subtitle for readability
        line-height: 1.4;
        max-width: 90%;
        margin: 0 auto; // Center the tagline/description
        font-weight: 400; // Regular weight for readability
      }
      a.edit-topic .d-icon {
        // Hide default Discourse edit icon to maintain landing page aesthetic
        display: none;
      }
    }

    // --- Hero Image Container ---
    // A prominent visual element, serving as the main hero image.
    .blog-image-container {
      // Background properties are already set for the image.
      .blog-image {
        height: 350px; // Generous height for impactful visual
        background-size: cover; // Image covers the area, cropping as needed
        background-position: center; // Center the image for better cropping
        border-radius: $border-radius-md; // Consistent rounded corners
        box-shadow: $shadow-md; // A more pronounced shadow for the hero image
      }
    }

    // --- Main Content Section (Post 1) ---
    // This transforms the first Discourse post into the main body of the landing page.
    #post_1 {
      padding: $spacing-lg $spacing-md; // More generous padding for main content

      .topic-body {
        padding-top: 0;

        &.highlighted {
          animation: none; // Disable highlighting for a clean landing page feel
        }

        // Hide elements not typically found on a minimalist landing page
        .topic-avatar,
        .topic-meta-data {
          display: none;
        }

        .contents {
          border-top: none; // Remove default Discourse border
          padding-top: 0; // No top padding here
        }

        .cooked {
          font-size: 1.15em; // Base font size for readability
          line-height: 1.75; // Optimal line height for long-form content
          word-wrap: break-word; // Ensures long words break correctly
          overflow-wrap: break-word; // Modern alternative
          color: var(--primary-text); // Primary text color for body

          // --- Buttons within Content ---
          // Styles for general links that should function as calls-to-action.
          // Excludes common Discourse elements that aren't intended as buttons.
          a:not(.lightbox):not(.d-icon):not(.mention):not(.hashtag):not(.cooked__link-text) {
            display: inline-block;
            background-color: var(--primary-action, #{$primary-action-sass});
            color: var(--primary-action-contrast, #{$primary-action-contrast-sass});
            padding: 16px $spacing-xl; // Increased padding for a larger tap target
            text-decoration: none;
            border-radius: $border-radius-md; // Soft rounded corners
            font-weight: bold;
            margin: $spacing-sm $spacing-xs $spacing-sm 0; // Spacing around buttons
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            white-space: nowrap; // Prevent button text from wrapping
            box-shadow: $shadow-sm; // Subtle shadow for buttons
            font-size: 1.05em; // Slightly larger font for clarity

            &:hover {
              background-color: darken($primary-action-sass, 8%);
              transform: translateY(-2px); // Subtle lift
              box-shadow: $shadow-md; // Enhanced shadow on hover
            }

            // Secondary Button Style (requires class="button-secondary")
            &.button-secondary {
              background-color: var(--tertiary-action, #{$tertiary-action-sass});
              color: var(--tertiary-action-contrast, #{$tertiary-action-contrast-sass});
              &:hover {
                background-color: darken($tertiary-action-sass, 8%);
              }
            }

            // Outline Button Style (requires class="button-outline")
            &.button-outline {
              background-color: transparent;
              color: var(--primary-action, #{$primary-action-sass});
              border: 2px solid var(--primary-action, #{$primary-action-sass});
              box-shadow: none; // No initial shadow for outline
              &:hover {
                background-color: var(--primary-action-low, #{$primary-action-low-sass});
                color: var(--primary-action-contrast, #{$primary-action-contrast-sass});
                box-shadow: $shadow-sm; // Add subtle shadow on hover
              }
            }
          }

          // --- Typography Refinements ---
          // Drop Cap Styling (for first letter of the content)
          big {
            font-size: 3rem; // More prominent drop cap
            line-height: 1; // Tighter line-height to fit text
            letter-spacing: -0.01em; // Adjust kerning for large characters
            display: inline-block;
            font-family: 'Georgia', serif; // Classic serif font for elegance
            margin-right: $spacing-xs; // Small space after the big letter
            color: var(--primary-action, #{$primary-action-sass}); // Highlight color
            font-weight: bold;
          }

          // Headings within the content section
          h2, h3, h4, h5, h6 {
            font-family: var(--font-family-headings, 'Roboto', 'Arial', sans-serif); // Modern sans-serif
            color: var(--primary-high);
            margin-top: $spacing-xl; // Ample space above new sections/subsections
            margin-bottom: $spacing-md; // Consistent space below heading
            line-height: 1.3;
            font-weight: 700; // Bold headings for clear hierarchy
          }
          h2 {
            font-size: 1.8em;
            letter-spacing: -0.01em;
          } // Sub-section title
          h3 {
            font-size: 1.5em;
          } // Content grouping title
          h4 {
            font-size: 1.3em;
          } // Minor heading

          p {
            margin-bottom: $spacing-md; // Consistent paragraph spacing
            line-height: 1.65; // Optimized for long-form reading
          }

          ul, ol {
            padding-left: $spacing-lg; // Indent lists for readability
            margin-bottom: $spacing-lg;
            li {
              margin-bottom: $spacing-xs; // Space between list items
              line-height: 1.6; // Improved line height for list items
            }
          }

          // Blockquote Styling - for testimonials or key quotes
          blockquote {
            background: var(--primary-very-low); // Soft background for quotes
            color: var(--primary-text); // Standard text color
            border-left: 6px solid var(--primary-action-low-mid, #{$primary-action-low-mid-sass}); // Thicker accent border
            padding: $spacing-md $spacing-lg; // Generous internal padding
            margin: $spacing-lg 0; // Vertical margin for separation
            border-radius: $border-radius-sm; // Subtle rounding
            font-style: italic; // Italicize quoted text
            position: relative; // For quote icon positioning
            box-shadow: $shadow-sm; // Gentle shadow

            &:before {
              // Large, subtle quote icon
              color: var(--primary-low-mid, lighten($primary-action-sass, 30%)); // Lighter for subtlety
              content: '“'; // Use a proper typographic quote character
              font-size: 6em; // Larger quote mark
              line-height: 0.1em;
              position: absolute;
              top: $spacing-sm;
              left: $spacing-sm;
              opacity: 0.15; // More subtle
              font-family: serif; // Ensure consistent serif font for quote mark
              z-index: 0; // Behind text
            }
            p {
              display: inline; // Ensures paragraphs inside blockquote flow
              position: relative; // Above pseudo-element
              z-index: 1;
            }
          }

          // --- Image Handling within Content ---
          // Hide initial redundant images often copied from hero section
          & > p:first-child + div.lightbox-wrapper,
          & > p img:not(.emoji):first-child {
            display: none;
          }

          // Display and style images embedded within content paragraphs
          & > p ~ p img:not(.emoji) {
            display: block;
            max-width: 100%;
            height: auto;
            margin: $spacing-lg auto; // Center images with good vertical spacing
            border-radius: $border-radius-md; // Rounded corners for images
            box-shadow: $shadow-md; // Prominent shadow for visual pop
          }

          figure {
            // Styling for images wrapped in <figure> tags (e.g., with captions)
            margin: $spacing-lg 0;
            padding: 0;
            text-align: center;
            img {
              max-width: 100%;
              height: auto;
              border-radius: $border-radius-md;
              box-shadow: $shadow-md; // Consistent shadow
            }
          }

          figcaption {
            margin-top: $spacing-sm; // Space between image and caption
            font-size: 0.95em; // Slightly larger for readability
            font-weight: normal;
            text-align: center;
            color: var(--primary-medium);
            line-height: 1.5;
          }
        }
      }

      // Hide default Discourse post controls, topic map, and admin menu for a clean landing page
      nav.post-controls,
      .topic-map,
      .post-admin-menu {
        display: none;
      }
    }

    // --- Dedicated Call-to-Action Section ---
    // This section is designed to be a highly visible and compelling prompt for user action.
    // Assumes you might add a `div class="call-to-action"` in your theme template.
    .call-to-action {
      background-color: var(--secondary-background); // A distinct, often vibrant background
      padding: $spacing-xxl $spacing-md; // Very generous padding for prominence
      text-align: center;
      border-radius: $border-radius-lg; // More pronounced rounded corners
      margin-top: $spacing-xxl; // Large space above
      margin-bottom: $spacing-xxl; // Large space below
      box-shadow: $shadow-lg; // Strong shadow to make it pop

      h2 {
        font-size: 2.2em; // Larger for main CTA heading
        color: var(--secondary-strong); // Strong color for CTA heading
        margin-bottom: $spacing-md;
        font-weight: 800; // Extra bold
        line-height: 1.15;
      }

      p {
        color: var(--secondary-text); // Text color for CTA description
        margin-bottom: $spacing-lg;
        font-size: 1.2em; // Larger for better readability
        line-height: 1.6;
        max-width: 90%;
        margin-left: auto;
        margin-right: auto;
      }

      a.button {
        // Styles for the main CTA button within this section
        display: inline-block;
        background-color: var(--secondary-action, #{$secondary-action-sass});
        color: var(--secondary-action-contrast, #{$secondary-action-contrast-sass});
        padding: 20px $spacing-xxl; // Large padding for very easy tapping
        text-decoration: none;
        border-radius: $border-radius-lg; // More rounded corners
        font-weight: bold;
        font-size: 1.3em; // Larger font for button text
        transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); // Stronger shadow for the button

        &:hover {
          background-color: darken($secondary-action-sass, 8%);
          transform: translateY(-4px) scale(1.02); // More pronounced lift and slight scale
          box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4); // Deeper shadow on hover
        }
      }
    }

    // --- Minimalist Landing Page Footer ---
    // A clean and subtle footer for copyright or light navigation.
    // Assumes you might add a `div class="landing-page-footer"` in your theme template.
    .landing-page-footer {
      text-align: center;
      padding: $spacing-lg $spacing-md;
      color: var(--primary-low-mid);
      font-size: 0.9em; // Slightly larger for readability
      border-top: 1px solid var(--primary-low); // Subtle separator
      background-color: var(--primary-background); // Matches main background
      margin-top: $spacing-xxl; // Ensure significant space from content above
    }
  }
}
